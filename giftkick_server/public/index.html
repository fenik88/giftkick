<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiftKick — Mini App (MVP)</title>
    <style>
        :root {
          --bg:#0f1724;--card:#0b1220;--accent:#2dd4bf;--muted:#94a3b8;--glass:rgba(255,255,255,0.03);
        }
        html,body{margin:0;height:100%;background:linear-gradient(180deg,#071127 0%,#07192b 100%);font-family:Inter,sans-serif;color:#e6eef6;}
        .app{max-width:460px;margin:18px auto;padding:14px;}
        .topbar{display:flex;align-items:center;gap:12px;}
        .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#1fb6b3,#2dd4bf);display:flex;align-items:center;justify-content:center;font-weight:700;color:#022;box-shadow:0 6px 18px rgba(10,10,20,0.6);}
        .title{flex:1;}
        .title h1{margin:0;font-size:16px;}
        .title p{margin:0;font-size:12px;color:var(--muted);}
        .balance{background:var(--glass);padding:8px 10px;border-radius:10px;display:flex;flex-direction:column;align-items:flex-end;}
        .balance .val{font-weight:700;color:var(--accent);}
        .tabs{display:flex;gap:8px;margin:14px 0;}
        .tab{flex:1;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);text-align:center;cursor:pointer;color:var(--muted);}
        .tab.active{background:linear-gradient(90deg, rgba(45,212,191,0.12), rgba(45,212,191,0.06));color:var(--accent);box-shadow:0 6px 18px rgba(25,45,60,0.5);}
        .card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);}
        .controls{display:flex;gap:8px;width:100%;}
        .btn{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg,#0b2730,#05202a);border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:#dff7f3;}
        .btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,0.04);color:var(--muted);}
        footer{margin-top:16px;text-align:center;font-size:12px;color:var(--muted);}
    </style>
</head>
<body>
<div class="app">
    <div class="topbar">
        <div class="logo">GK</div>
        <div class="title"><h1>GiftKick</h1><p id="userName">Привет, игрок</p></div>
        <div class="balance card"><div class="small">Баланс</div><div class="val" id="balanceVal">0</div></div>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="rocket">Ракетка</div>
        <div class="tab" data-tab="cases">Кейсы</div>
        <div class="tab" data-tab="upgrade">Апгрейд</div>
    </div>

    <div id="content">
        <div class="card" id="rocketView">
            <div class="controls">
                <input id="betInput" type="number" min="1" value="10" style="flex:0 0 34%;padding:8px;border-radius:8px;background:#08151b;border:1px solid rgba(255,255,255,0.03);color:#dff7f3"/>
                <button class="btn" id="betBtn">Ставка</button>
            </div>
        </div>

        <div class="card" id="casesView" style="display:none">
            <div class="controls">
                <button class="btn openCase" data-cost="10">Открыть кейс 10</button>
                <button class="btn openCase" data-cost="50">Открыть кейс 50</button>
            </div>
        </div>

        <div class="card" id="upgradeView" style="display:none">
            <div class="controls">
                <button class="btn upgradeBtn" data-mult="2" data-stake="10">x2 — 50%</button>
                <button class="btn upgradeBtn" data-mult="5" data-stake="20">x5 — 20%</button>
            </div>
        </div>
    </div>

    <footer>GiftKick • MVP</footer>
</div>

<script>
    const userId = 'user123';
    let balance = 0;

    // Таб переключения
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        const target = tab.dataset.tab;
        document.getElementById('rocketView').style.display = target==='rocket'?'block':'none';
        document.getElementById('casesView').style.display = target==='cases'?'block':'none';
        document.getElementById('upgradeView').style.display = target==='upgrade'?'block':'none';
      });
    });

    // Получаем пользователя
    fetch('/api/user', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({userId})})
      .then(r=>r.json()).then(data=>{
        balance = data.user.balance;
        document.getElementById('balanceVal').textContent = balance;
    });

    // Ракетка
    document.getElementById('betBtn').addEventListener('click', ()=>{
      const bet = parseInt(document.getElementById('betInput').value);
      fetch('/api/rocket', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({userId, bet})})
        .then(r=>r.json()).then(data=>{
          if(data.ok){ balance = data.newBalance; document.getElementById('balanceVal').textContent = balance; alert('Crash x'+data.crashAt); }
          else alert(data.error);
        });
    });

    // Кейсы
    document.querySelectorAll('.openCase').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const cost = parseInt(btn.dataset.cost);
        fetch('/api/case', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({userId,cost})})
          .then(r=>r.json()).then(data=>{
            if(data.ok){ balance=data.newBalance; document.getElementById('balanceVal').textContent=balance; alert('Вы получили: '+data.prize+' (+'+data.payout+')'); }
            else alert(data.error);
          });
      });
    });

    // Апгрейды
    document.querySelectorAll('.upgradeBtn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const stake=parseInt(btn.dataset.stake);
        const mult=parseInt(btn.dataset.mult);
        fetch('/api/upgrade',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,stake,mult})})
          .then(r=>r.json()).then(data=>{
            if(data.ok){ balance=data.newBalance; document.getElementById('balanceVal').textContent=balance; alert(data.won?'Вы выиграли '+data.gain:'Проигрыш'); }
            else alert(data.error);
          });
      });
    });
</script>
</body>
</html>
