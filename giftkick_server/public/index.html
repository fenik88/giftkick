<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiftKick ‚Äî Mini App</title>
    <style>
        body { background:#071127; font-family:sans-serif; color:#fff; margin:0; padding:0; }
        .app { max-width:460px; margin:20px auto; padding:10px; }
        .tabs { display:flex; gap:8px; margin-bottom:10px; }
        .tab { flex:1; padding:10px; text-align:center; cursor:pointer; background:rgba(255,255,255,0.1); border-radius:8px; }
        .tab.active { background:#2dd4bf; color:#000; }
        .card { background:#0b1220; padding:10px; margin-bottom:10px; border-radius:8px; }
        .btn { padding:10px; margin:5px; cursor:pointer; background:#2dd4bf; border:none; border-radius:6px; }
        .btn.ghost { background:transparent; border:1px solid #2dd4bf; color:#2dd4bf; }
        .mult { font-size:32px; font-weight:bold; margin-bottom:5px; }
        .bar { width:100%; height:12px; background:rgba(255,255,255,0.1); border-radius:8px; overflow:hidden; margin-bottom:5px; }
        .fill { height:100%; width:0%; background:#2dd4bf; transition:width 0.1s linear; }
    </style>
</head>
<body>
<div class="app">
    <div>–ë–∞–ª–∞–Ω—Å: <span id="balance">1000</span></div>

    <div class="tabs">
        <div class="tab active" data-tab="rocket">–†–∞–∫–µ—Ç–∫–∞</div>
        <div class="tab" data-tab="cases">–ö–µ–π—Å—ã</div>
        <div class="tab" data-tab="upgrade">–ê–ø–≥—Ä–µ–π–¥</div>
    </div>

    <div id="rocketView" class="card">
        <div class="mult" id="multiplier">x1.00</div>
        <div class="bar"><div class="fill" id="rocketFill"></div></div>
        <input type="number" id="betInput" value="10" min="1"/>
        <button class="btn" id="betBtn">–°—Ç–∞–≤–∫–∞</button>
        <button class="btn ghost" id="cashOutBtn">–ó–∞–±—Ä–∞—Ç—å</button>
        <div id="rocketStatus">–†–∞—É–Ω–¥ –Ω–µ –Ω–∞—á–∞–ª—Å—è</div>
    </div>

    <div id="casesView" class="card" style="display:none">
        <div class="case" data-cost="10">Starter <button class="btn openCase">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ 10</button></div>
        <div class="case" data-cost="50">Pro <button class="btn openCase">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ 50</button></div>
        <div class="case" data-cost="200">VIP <button class="btn openCase">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ 200</button></div>
    </div>

    <div id="upgradeView" class="card" style="display:none">
        <div class="upgrade-item">
            x2 ‚Äî 50% —à–∞–Ω—Å <button class="btn upgradeBtn" data-mult="2" data-stake="50">–ò–≥—Ä–∞—Ç—å</button>
        </div>
        <div class="upgrade-item">
            x5 ‚Äî 20% —à–∞–Ω—Å <button class="btn upgradeBtn" data-mult="5" data-stake="50">–ò–≥—Ä–∞—Ç—å</button>
        </div>
        <div class="upgrade-item">
            x10 ‚Äî 10% —à–∞–Ω—Å <button class="btn upgradeBtn" data-mult="10" data-stake="50">–ò–≥—Ä–∞—Ç—å</button>
        </div>
    </div>
</div>

<script>
    const userId = 'user123';
    let balance = 1000;
    let rocketInterval;
    let currentMult = 1;
    let betAmount = 0;
    let crashAt = 0;
    let rocketRunning = false;

    // Tabs
    document.querySelectorAll('.tab').forEach(tab=>{
        tab.addEventListener('click', ()=>{
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById('rocketView').style.display = tab.dataset.tab==='rocket'?'block':'none';
            document.getElementById('casesView').style.display = tab.dataset.tab==='cases'?'block':'none';
            document.getElementById('upgradeView').style.display = tab.dataset.tab==='upgrade'?'block':'none';
        });
    });

    // Rocket
    const multiplierEl = document.getElementById('multiplier');
    const rocketFill = document.getElementById('rocketFill');
    const statusEl = document.getElementById('rocketStatus');

    document.getElementById('betBtn').addEventListener('click', async ()=>{
        if(rocketRunning) return;
        betAmount = Number(document.getElementById('betInput').value);
        if(betAmount > balance) { alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
        const res = await fetch('/api/rocket',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,bet:betAmount})});
        const data = await res.json();
        crashAt = data.crashAt;
        balance = data.newBalance;
        updateBalance();
        startRocket();
    });

    document.getElementById('cashOutBtn').addEventListener('click', ()=>{
        if(!rocketRunning) return;
        rocketRunning = false;
        clearInterval(rocketInterval);
        const gain = Math.round(betAmount * currentMult * 100)/100;
        balance += gain;
        updateBalance();
        statusEl.textContent = `–í—ã –∑–∞–±—Ä–∞–ª–∏: ${gain}`;
        currentMult = 1;
        rocketFill.style.width = '0%';
        multiplierEl.textContent = 'x1.00';
    });

    function startRocket(){
        rocketRunning = true;
        currentMult = 1;
        multiplierEl.textContent = 'x1.00';
        rocketFill.style.width = '0%';
        statusEl.textContent = '–ü–æ–ª—ë—Ç!';
        let time = 0;
        rocketInterval = setInterval(()=>{
            time+=0.1;
            currentMult = Math.pow(1.05,time); // –ø–ª–∞–≤–Ω—ã–π —Ä–æ—Å—Ç
            multiplierEl.textContent = 'x'+currentMult.toFixed(2);
            rocketFill.style.width = Math.min(100, currentMult*8)+'%';
            if(currentMult >= crashAt){
                rocketRunning = false;
                clearInterval(rocketInterval);
                statusEl.textContent = '–†–∞–∫–µ—Ç–∞ –≤–∑–æ—Ä–≤–∞–ª–∞—Å—å! üí•';
                currentMult = 1;
                rocketFill.style.width='0%';
                multiplierEl.textContent='x1.00';
            }
        },100);
    }

    // Cases
    document.querySelectorAll('.openCase').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
            const cost = Number(btn.parentElement.dataset.cost);
            const res = await fetch('/api/case',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,cost})});
            const data = await res.json();
            if(data.ok){
                balance = data.newBalance;
                updateBalance();
                alert(`–í—ã –ø–æ–ª—É—á–∏–ª–∏: ${data.prize} (–í—ã–∏–≥—Ä—ã—à: ${data.payout})`);
            }
        });
    });

    // Upgrades
    document.querySelectorAll('.upgradeBtn').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
            const mult = Number(btn.dataset.mult);
            const stake = Number(btn.dataset.stake);
            const res = await fetch('/api/upgrade',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,mult,stake})});
            const data = await res.json();
            if(data.ok){
                balance = data.newBalance;
                updateBalance();
                alert(data.won ? `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${data.gain}` : '–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!');
            }
        });
    });

    function updateBalance(){
        document.getElementById('balance').textContent = balance.toFixed(2);
    }
</script>
</body>
</html>
